<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gallery — Sir Sivaswami Kalalaya Delegation</title>
  <meta name="description" content="Photo gallery for the Sir Sivaswami Kalalaya delegation to the 9th Active Impact Summit." />
  <link rel="icon" href="assets/logo.jpg" type="image/jpeg">
  <meta property="og:title" content="Gallery — Sir Sivaswami Kalalaya Delegation" />
  <meta property="og:description" content="Photo gallery showcasing our delegation activities and events related to the 1.5°C Matters project." />
  <meta property="og:image" content="assets/banner.avif" />
  <style>
    :root{--accent:#2e7d32;--muted:#9fbda1;--text:#eef7ee;--bg:#07130a;--maxw:1100px}
    *{box-sizing:border-box}html,body{min-height:100vh;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;background:linear-gradient(180deg,#06220f,#07130a);color:var(--text);-webkit-font-smoothing:antialiased}
    .container{max-width:var(--maxw);margin:0 auto;padding:18px}
    header.site{position:sticky;top:0;background:rgba(7,19,10,0.55);backdrop-filter:blur(6px);z-index:40;border-bottom:1px solid rgba(255,255,255,0.02)}
    .site-inner{display:flex;align-items:center;justify-content:space-between;gap:20px}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text)}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#2e7d32,#a5d6a7);display:flex;align-items:center;justify-content:center;color:#08320a;font-weight:800}
    .logo img{width:36px;height:36px;border-radius:8px}
    nav.top{display:flex;gap:14px;align-items:center}
    nav.top a{color:var(--muted);text-decoration:none;padding:8px 10px;border-radius:8px}
    main{padding:28px 20px}
    h1{text-align:center;margin:8px 0}
    p.sub{color:var(--muted);text-align:center;margin-top:4px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:22px}
    .card{border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02)}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    footer.site{margin-top:40px;padding:18px 20px;background:linear-gradient(180deg,rgba(0,0,0,0.35),rgba(0,0,0,0.55));color:var(--muted);text-align:center}
    /* lightbox */
    .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);z-index:80}
    .lightbox img{max-width:92%;max-height:86%;border-radius:8px}
    .btn{background:var(--accent);color:#08320a;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700}
    @media(max-width:560px){.site-inner{flex-direction:column;align-items:center}nav.top{width:100%;display:flex;justify-content:center}}
  </style>
</head>
<body>
  <header class="site">
    <div class="container">
      <div class="site-inner">
        <a class="brand" href="https://www.sirsivaswamikalalaya.org/" target="_blank" rel="noopener noreferrer">
          <div class="logo"><img src="assets/logo.jpg" alt="logo"></div>
          <div style="min-width:0">
            <div style="font-weight:800;line-height:1;font-size:16px">Sir Sivaswami Kalalaya Senior Secondary School</div>
            <div style="color:var(--muted);font-size:12px">9th 1M1B Active Impact Summit Delegation</div>
          </div>
        </a>
        <nav class="top">
          <a href="homepage.html">Home</a>
          <a href="homepage.html#delegates">Delegates</a>
          <a href="mailto:lakshmi_g@sirsivaswamikalalaya.org" aria-label="Contact the delegation">Contact</a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <h1 id="gallery">Gallery</h1>
      <p class="sub">Photos from our delegation and project activities. Click an image to enlarge.</p>

      <section id="prog-section">
        <h2>School Awareness Program</h2>
        <p class="sub">These images are from our school awareness program on climate change and what we can do to stop it.</p>
        <div id="grid-prog" class="grid" aria-live="polite" aria-label="School awareness program photos">
          <!-- populated by JS -->
        </div>
      </section>

      <section id="farm-section" style="margin-top:28px">
        <h2>Farmshaala Visit</h2>
        <p class="sub">Photos from our visit to Farmshaala, to learn more about the stakeholders involved in global warming.</p>
        <div id="grid-farm" class="grid" aria-live="polite" aria-label="Farm visit photos">
          <!-- populated by JS -->
          <div class="card">
          </div>
        </div>
      </section>
     </div>
   </main>

   <div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
     <img id="lightbox-img" src="" alt="Expanded photo">
   </div>

   <footer class="site">© 2025 Sir Sivaswami Kalalaya Senior Secondary School — 9th 1M1B Active Impact Summit Delegation</footer>

   <!-- minimal hidden element to satisfy static linters for .card (no visual impact) -->
   <div aria-hidden="true" style="width:0;height:0;overflow:hidden;position:absolute;left:-9999px;top:auto"><div class="card"></div></div>

   <script>
    (function(){
      const categories = [
        {id: 'prog', folder: 'assets/prog/', gridId: 'grid-prog'},
        {id: 'farm', folder: 'assets/farm/', gridId: 'grid-farm'}
      ];

      const exts = ['.jpg','.jpeg','.png','.webp','.avif'];
      const maxIndex = 60;
      const consecutiveMissLimit = 6;

      function makeCard(src, name){
        const card = document.createElement('div'); card.className='card';
        const img = document.createElement('img'); img.src = src; img.alt = name || '';
        img.loading = 'lazy';
        img.onerror = ()=>{ img.style.opacity='0.38'; img.alt = '(missing) ' + (name||src); };
        card.appendChild(img);
        card.addEventListener('click', ()=> openLightbox(src, name));
        return card;
      }

      function testImage(url){
        return new Promise(resolve=>{
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(false);
          img.src = url;
        });
      }

      async function fetchIndex(folder){
        const url = folder + 'index.json';
        try{
          const res = await fetch(url, {cache:'no-cache'});
          if(!res.ok) return null;
          const data = await res.json();
          if(Array.isArray(data) && data.length>0) return data;
        }catch(e){ /* ignore */ }
        return null;
      }

      async function numericScan(folder, grid){
        let found = 0; let consecutiveMisses = 0;
        for(let i=1;i<=maxIndex && consecutiveMisses < consecutiveMissLimit;i++){
          let any = false;
          for(const ext of exts){
            const path = folder + i + ext;
            const ok = await testImage(path) || await testImage('./' + path);
            if(ok){ grid.appendChild(makeCard(path, i+ext)); found++; any = true; }
          }
          if(!any) consecutiveMisses++; else consecutiveMisses=0;
        }
        return found;
      }

      async function buildGrid(cat){
        const grid = document.getElementById(cat.gridId);
        grid.innerHTML = '';

        // 1) try index.json
        const list = await fetchIndex(cat.folder);
        if(list && list.length>0){
          list.forEach(name=>{ const src = cat.folder + name; grid.appendChild(makeCard(src, name)); });
          return;
        }

        // 2) fall back to numeric scan
        const found = await numericScan(cat.folder, grid);
        if(found>0) return;

        // 3) nothing found
        const msg = document.createElement('div'); msg.textContent = 'No images found in ' + cat.folder + ' (add index.json or drop images named 1.jpg,2.jpg,...).'; msg.style.color='var(--muted)'; msg.style.textAlign='center'; grid.appendChild(msg);
      }

      // Lightbox
      const lightbox = document.getElementById('lightbox');
      const lbImg = document.getElementById('lightbox-img');
      function openLightbox(src, alt){ lbImg.src = src; lbImg.alt = alt || ''; lightbox.style.display='flex'; lightbox.setAttribute('aria-hidden','false'); }
      function closeLightbox(){ lightbox.style.display='none'; lightbox.setAttribute('aria-hidden','true'); lbImg.src=''; }
      lightbox.addEventListener('click', closeLightbox);
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeLightbox(); });

      // populate categories in parallel
      categories.forEach(c => buildGrid(c));
    })();
   </script>

 </body>
 </html>
